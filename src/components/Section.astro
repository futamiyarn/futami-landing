---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<div class="section-container" data-state="open">
  <!-- Header Clickable -->
  <div 
    class="section-header flex items-center gap-2 pl-2 mb-2 cursor-pointer select-none group" 
    role="button"
    tabindex="0"
  >
    <h2 class="text-2xl font-bold text-on-surface flex-1">{title}</h2>
    
    <!-- Flip Arrow Button -->
    <button 
      class="toggle-btn w-8 h-8 rounded-full bg-surface-container-high text-primary flex items-center justify-center transition-transform duration-300 ease-[cubic-bezier(0.2,0,0,1)] hover:bg-[color-mix(in_srgb,var(--md-sys-color-primary)_10%,var(--md-sys-color-surface-container-high))]"
      aria-label="Toggle section"
    >
      <i class="fa-solid fa-chevron-down"></i>
    </button>
  </div>

  <!-- Collapsible Content -->
  <div class="collapsible-content overflow-hidden max-h-[1000px] opacity-100 transition-all duration-400 ease-[cubic-bezier(0.2,0,0,1)]">
    <div class="bg-surface-container p-6 rounded-4xl flex flex-col gap-4 mb-2">
      <slot />
    </div>
  </div>

  <!-- Footer / More Actions -->
  <div class="mt-1 flex justify-end">
    <slot name="action" />
  </div>
</div>

<script>
  const sections = document.querySelectorAll('.section-container');

  sections.forEach(section => {
    const header = section.querySelector('.section-header');
    const btn = section.querySelector('.toggle-btn');
    const content = section.querySelector('.collapsible-content') as HTMLElement;
    
    // Init height
    if(content) content.style.maxHeight = content.scrollHeight + "px";

    header?.addEventListener('click', () => {
      const currentState = section.getAttribute('data-state');
      const newState = currentState === 'open' ? 'closed' : 'open';
      
      section.setAttribute('data-state', newState);

      if (newState === 'closed') {
        content.style.maxHeight = '0px';
        content.style.opacity = '0';
        btn?.classList.add('-rotate-90');
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
        content.style.opacity = '1';
        btn?.classList.remove('-rotate-90');
      }
    });
  });
</script>
